- [JVM100道面试问题](#JVM100道面试问题)
  - [JVM面试之类加载](#JVM面试之类加载)
    - [类加载机制](#类加载机制)
  - [JVM面试之运行时数据区域](#JVM面试之运行时数据区域)
    - [运行时数据区域](#运行时数据区域)
    - [程序计数器](#程序计数器)
    - [虚拟机栈及本地方法栈](#虚拟机栈及本地方法栈)
    - [方法区](#方法区)
    - [永久代与元空间](#永久代与元空间)
    - [堆区](#堆区)

# JVM100道面试问题

## JVM面试之类加载

### 类加载机制

- 类加载的定义
- 类加载的时机
- 类加载的目的

1、类加载是Java虚拟机将class数据二进制字节流读入类加载器，解析出类的元信息（InstanceKlass）并写入方法区，解析出类的Class对象（InstanceMirrorKlass）并写入堆区等过程

[补充]class数据二进制字节流无关乎来源，可以是操作系统文件（单个文件 或 jar包中），可以是网络流数据，可以是数据库数据等

[补充]javac编译器会将.java文件编译成.class文件，用于java虚拟机类加载

3、类加载会在4种情况下执行
- java虚拟机启动时，加载mainClass（main方法所在的类）
- 字节码引擎执行遇到new、putstatic、getstatic、invokestatic时，若对应类未被加载，会进行类加载
- 加载一个类时，若父类未被加载，会优先加载父类，再加载子类
- 利用反射机制（Class.forname(packageName.ClassName)）加载一个类时，会进行类加载

4、类加载的目的是将class数据解析成类的元信息、类的Class对象等数据存入运行时数据区域，为后续的对象实例化、静态变量的取值及赋值、静态方法的调用等过程提供数据准备

## JVM面试之运行时数据区域

### 运行时数据区域

- 定义
- 五大部分

1、Java虚拟机在操作系统中申请了一块内存区域，用于运行Java程序

2、这块内存区域中有5个部分，分别是程序计数器、虚拟机栈、本地方法栈、方法区、堆区

### 程序计数器

- 定义：字节码行号指示器
- 线程私有
- 与字节码解释器的关系

1、程序计数器是线程所执行的字节码的行号指示器

2、线程私有的，每个线程都有一个程序计数器

3、字节码解释器工作时就是改变程序计数器的计数值来选取下一行需要执行的字节码指令

### 虚拟机栈及本地方法栈

- 定义，方法调用与执行的内存模型
- 线程私有
- 与本地方法栈的关系
- 与栈帧的关系
- 栈溢出例子

1、虚拟机栈描述的是Java方法调用与执行的内存模型

2、线程私有的，每个线程都有一个虚拟机栈及本地方法栈

3、本地方法栈为native方法服务，虚拟机栈为非native方法服务

4、栈帧是虚拟机栈的基本元素，每个方法从调用到执行完成的过程，都对应着一个栈帧在虚拟机栈中从入栈到出栈的过程，即一个栈帧对应着一次方法调用执行

5、栈帧中含有局部变量表、操作数栈、动态链接、方法返回地址、附加信息

6、让栈溢出有两种思路，一是方法循环调用自己，二是不断创建线程调用一个方法，前者是java.lang.StackOverflowError，后者是java.lang.OutOfMemoryError: unable to create new native thread

### 方法区

- 定义，主要存放类的元信息
- 线程共享
- 永久代与元空间
- 运行时常量池
- 方法区溢出例子

### 永久代与元空间

- JDK6到8
  - 类的元信息
  - 符号引用
  - 静态变量
  - 字符串常量池
  - 运行时常量池
  - 与堆区内存的连续性
- 元空间取代永久代的理由
  - OOM问题
  - 垃圾回收
  - 计算机内存的发展
  - HotSpot与JRockit代码合并

### 堆区
