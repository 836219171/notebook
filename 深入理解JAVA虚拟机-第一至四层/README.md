# 深入理解JAVA虚拟机-第一至四层

### 前言

我希望写多篇文章，组合成一份文章集，包含关于JAVA虚拟机的入门原理、常见问题、代码例子证明等

读者阅读它，能像读小说一样，从第一篇文章，读到最后一篇文章，中间不带卡主，尽量把讳莫如深难懂的内容写得简单易懂。当然这也需要读者具有一定的JAVA功底

### JAVA虚拟机的定义

无论讨论什么，我们先需要将定义讨论清楚，否则就会有无穷的争执

JAVA虚拟机是一种能够运行JAVA字节码程序的虚拟机器

> A Java virtual machine (JVM) is a virtual machine that enables a computer to run Java programs as well as programs written in other languages that are also compiled to Java bytecode. From https://en.wikipedia.org/wiki/Java_virtual_machine.

### JAVA语言的水深

JAVA这潭大湖，从上往下，一共有7层（人为定义的）。参考 [JAVA学习蓝图，从基础、集合、并发、JVM原理，到应用框架](https://github.com/peteryuanpan/notebook/issues/51)

- JAVA语言
- JAVA字节码
- JVM原理
- JVM源码
- 操作系统层
- 汇编层
- 硬编码层

笔者的能力是有限的，望大家见谅，这篇文章能接触到的水深，只有第 1-3 层 + 第4层表面，第4层JVM源码往下，这篇文章不会深入包含

如果读者要问我为何第4层开始往下不深入包含了，我只能说，我也很无奈呀，实在能力有限，短时间内还做不到呐

### 关于第4层

第4层是JVM源码

在准备这份笔记同时，实际上是我在整理自己对JVM原理等的理解

但是我发现，纯理论的理解，是有瓶颈的，你可以通过图表去加深理解，可以通过网上更多资料细节去巩固理解，但是你永远只是停留在理论上，没有实践

就好比，高中时上化学课，背元素周期表、化学反应方程式、基础化学分子的现象特征等，这些固然需要，但你希望深入理解化学，深入记忆，只停留在理论不足以的，一定需要实践，即做实验，这也是我国学生的一个普遍问题点------动手能力差

鲁班学院的子牙老师，有提供Ubuntu虚拟机环境的镜像，上面可以调试jvm，查看源码并理解

我做了个笔记，记录于：[Windows上用虚拟机运行Ubuntu环境并调试JVM](https://github.com/peteryuanpan/notebook/issues/89) ，这份笔记非常有用，但也只是个开始

因此，虽然这篇文章接触到的水深，只有第 1-3 层 + 第4层表面，但是我也会尽量的通过第 4 层，拿出源码例子，来帮助第 3 层加深理解

不深入包含第 4 层，含义是只是用源码例子来解释，但不会去深入分析，甚至去编写JVM源码的一部分code来理解。。做不到

push了一份jvm源码到 https://github.com/peteryuanpan/openjdk-8u40-source-code-mirror ，接下来分析、Debug都用它

### 如何学习JVM

两个方向：内存模型、字节码

一个好方法：学习了一块知识点后，自己开视频录制，复述出来，一遍一遍地过，直到讲明白为止

### JVM运行时环境全景图

这份图在其他文章中会经常用的，它描述了JVM运行时环境的基本元素、关系等

![image](http://tswork.peterpy.cn/java_runtime.png)

### 文章目录（不断修改中...）

#### 文章大纲

标题 => 定义、解释 => 问题1、回答1、...、问题n、回答n（回答要准确、简扼，能证明则证明）

#### 第1章：类加载机制与类加载器
- [类加载机制](类加载机制.md)
  - [类加载的定义](类加载机制.md#类加载的定义)
  - [类加载的输入和输出结果](类加载机制.md#类加载的输入和输出结果)
  - [InstanceKlass和InstanceMirrorKlass是什么](类加载机制.md#instanceklass和instancemirrorklass是什么)
  - [类加载什么时候会进行](类加载机制.md#类加载什么时候会进行)
    - [加载mainClass](类加载机制.md#当虚拟机启动时用户需要指定一个要执行的主类包含main方法的那个类虚拟机会先初始化这个主类)
    - [new、getstatic、putstatic、invokestatic](类加载机制.md#遇到-newgetstaticputstatic-或-invokestatic-这4条字节码指令时如果类没有进行过初始化则需要先)
    - [优先加载父类](类加载机制.md#当初始化一个类的时候如果发现其父类还没有进行过初始化则需要先触发其父类的初始化)
    - [反射](类加载机制.md#使用-javalangreflect-包的方法对类进行反射调用的时候如果类没有进行过初始化则需要先触发其初始化)
  - [运行期动态类加载](类加载机制.md#运行期动态类加载)
  - [广义的类文件是二进制字节流](类加载机制.md#广义的类文件是二进制字节流)
  - [类加载的五个过程](类加载机制.md#类加载的五个过程)
    - [加载](类加载机制.md#加载)
    - [验证](类加载机制.md#验证)
    - [准备](类加载机制.md#准备)
    - [解析](类加载机制.md#解析)
    - [初始化](类加载机制.md#初始化)
- [类加载器]
  - 三种系统类加载器
    - 启动类加载器
    - 拓展类加载器
    - 应用类加载器
  - 双亲委派模型
  - 破坏双亲委派模型
    - 自定义类加载器
    - 线程上下文类加载器与SPI机制
  
#### 第2章：Class类文件结构与字节码手册

#### 第3章：JVM内存模型之运行时数据区域

#### 第4章：对象的创建使用与内存布局

#### 第5章：垃圾收集算法与垃圾收集器

#### 第6章：JVM调优工具与实战
